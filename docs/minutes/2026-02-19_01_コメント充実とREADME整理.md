# 2026-02-19_01 コメント充実とREADME整理

## 1. 実施内容

- `main.py` の主要処理に、引き継ぎ向けコメントと補助 docstring を追加。
  - lock 取得/解放の意図
  - queue 処理時の成功/失敗遷移方針
  - fullsync offset 更新の判定意図
  - ingest のトランザクション境界
- `README.md` を引き継ぎ資料として再整理。
  - 先頭で運用原則を明示
  - 実行フロー、障害時一次対応、既知課題を再構成
  - CLI / ディレクトリ / 日次運用チェックを整理
  - `dict-build` の実処理が `run_incremental_build` 委譲である点を追記

## 2. 今回確認できた課題

1. **ロック残留の自動復旧がない**
   - 現在は lock ファイル方式で、stale 判定（PID/TTL）未実装。
   - 異常終了時に運用者の手動削除が必要。

2. **failed ingest 再処理の手順が運用依存**
   - `data/failed/` の JSONL 再投入は手順としては可能だが、CLI 化されていない。
   - 取り込み状態（`ingest_files`）との整合を運用者が判断する必要がある。

3. **監視運用の定義不足**
   - `ERROR` / `FAILED` 件数増加の閾値・通知先・初動手順が未定義。
   - 今後は運用設計（監視項目、通知頻度、対応SLA）をドキュメント化する必要がある。

## 3. 次アクション提案

- lock の stale 判定導入（例: ロック作成時刻 + PID 記録、TTL 超過時の再取得）
- failed ingest 再投入を補助する CLI の追加
- 監視観点を `docs/` 配下に標準化（最低限: queue ERROR、ingest FAILED、lock 残留）
