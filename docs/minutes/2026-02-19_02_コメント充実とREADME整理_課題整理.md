# 2026-02-19 コメント充実と README 整理に伴う課題整理

## 1. 実施概要

- `README.md` を、初級者が追いやすい順序（入口→実行フロー→運用→障害対応）で再整理した。
- `app/orchestrator.py` と `main.py` に、処理意図が読み取れる日本語コメント／docstring を追加した。
- コード挙動の変更は行わず、可読性と引き継ぎ性を主目的とした。

## 2. 今回の確認で見えた課題

### 課題A: ロック運用が手動依存

- 現状はファイルロック方式で、stale 判定（古いロックの自動回収）がない。
- 異常終了後にロックが残ると、運用担当者が手動で削除する必要がある。

**影響**
- 夜間バッチ停止を見逃すと同期遅延が長期化する。

**次アクション案**
- ロック作成時に PID / ホスト / 時刻を保存し、TTL 超過時の警告または自動解放ポリシーを定義する。

---

### 課題B: `data/failed/` 再投入フローの標準化不足

- 失敗ファイル再投入の判断・手順が README と運用者経験に依存している。
- スクリプト化されておらず、担当者によるばらつきが出る可能性がある。

**影響**
- 障害復旧時間が担当者スキルに左右される。

**次アクション案**
- `failed` から `staging` へ戻す補助 CLI（dry-run 付き）を設計し、再投入手順を定型化する。

---

### 課題C: 監視閾値・通知設計の未整備

- `request_queue.ERROR` や `ingest_files.FAILED` の増加を監視する閾値が未定義。
- 受動的なログ確認に依存している。

**影響**
- 問題の早期検知が難しく、復旧着手が遅れる可能性がある。

**次アクション案**
- 日次点検指標（件数上限、連続失敗回数）を定義し、閾値超過時の通知方法（メール/チャット）を運用設計へ追加する。

## 3. 初級者向けメモ

- このプロジェクトは「1回で終わらせる」のではなく、「壊れにくく小刻みに進める」思想で作られている。
- そのため、エラー時は**即時復旧より、データ喪失を防ぐ設計**（`failed` 退避）が優先される。
- 迷った場合は、まず `README.md` の「日次運用チェック」と「障害時の一次対応」を順に確認する。
