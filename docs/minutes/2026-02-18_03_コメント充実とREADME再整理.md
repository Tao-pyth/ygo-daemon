# 2026-02-18_03_コメント充実とREADME再整理

## 実施内容

- `README.md` を引き継ぎ用途に合わせて章立てを再整理。
  - 「守る前提」「実行フロー」「運用チェック」「既知課題」を分離し、確認順を明確化。
- `app/orchestrator.py` に、実行順序が運用ポリシーに直結する旨の docstring / コメントを追加。
- `main.py` に、queue消化・ingest登録・ingest失敗時退避の意図が伝わるコメントを追加。

## 作業で再確認した課題

1. **offset/num 全件同期ルートが未接続**
   - `cardinfo_fullsync_page` 実装はあるが、`run` の主経路に組み込まれていない。
   - queue が空の時に 1 ページだけ進める仕様へ接続が必要。

2. **stale lock の自動回復設計が未整備**
   - 現状は lock ファイルの存在判定のみ。
   - 異常終了時に人手で lock 削除が必要になる。

3. **failed ingest の復旧ランブック不足**
   - `data/failed/` へ退避する仕組みはあるが、
     「どの順で調査・再投入するか」の運用手順が文書化されていない。

## 引き継ぎ向け提案

- `docs/` 配下に「failed ingest 復旧手順」を追加し、運用者が迷わない実行手順を固定化する。
- lock ファイルへ PID / 起動時刻を書き込み、一定時間超過時の stale 判定ルールを定義する。
- `execute_run_cycle` に full sync 1ページ進行ステップを追加し、仕様書と実装を一致させる。
