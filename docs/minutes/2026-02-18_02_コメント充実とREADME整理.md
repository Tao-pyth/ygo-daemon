# 2026-02-18_02_コメント充実とREADME整理

## 実施内容

- `app/orchestrator.py` に実行順序の意図・queue優先ポリシー・`dbver_changed` 時の段階回収方針をコメント／docstringとして明記。
- `README.md` を章立てで再整理し、運用担当が参照しやすい構成へ更新。
- 実行時データ配置、運用チェックポイント、既知課題をREADMEから辿れるよう整理。

## 作業中に再確認した課題

1. **offset/num 全件同期の本実装が未接続**
   - 現状は queue 消化 + `NEED_FETCH` 補充で段階運用している。
   - 仕様書記載の `meta.next_page_offset` を使ったページ進行は未接続。

2. **stale lock 対策が弱い**
   - `data/lock/daemon.lock` の存在のみで排他判定している。
   - 異常終了時にロックファイルが残ると手動復旧が必要。

3. **ingest失敗時の運用手順が未整備**
   - ファイルは `data/failed/` へ退避されるが、
     「再投入方法」「失敗原因の一次切り分け手順」の文書化が不足。

## 引き継ぎ向け提案

- 次回リリースで `offset/num` ルートを `execute_run_cycle` に接続し、
  queue空時に「1ページだけ進める」仕様へ揃える。
- ロックファイルにPID/起動時刻を保持し、
  一定時間超過時の stale 判定と自動回復方針を追加する。
- `docs/` 配下に「failed ingest 復旧手順」を新設し、
  監視アラートからの復旧フローを固定化する。
